name: Test and Deploy Website

on:
  push:
    branches:
      - main

jobs:

  # ------------------------
  # 1. SIMPLE TEST
  # ------------------------
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run simple test
        run: |
          echo "Running simple test..."
          if [ -f "index.html" ]; then
            echo "‚úî Test OK : index.html exists"
            exit 0
          else
            echo "‚ùå Test failed : index.html missing"
            exit 1
          fi

  # ------------------------
  # 2. BUILD + DEPLOY
  # ------------------------
  deploy:
    needs: test          # üí° Build only if tests pass
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pages: write
      id-token: write

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build with Jekyll
        uses: actions/jekyll-build-pages@v1

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v2
